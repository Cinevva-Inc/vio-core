this.lozi=function(e){var t={};function r(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);class a{static getObjectByProperty(e,t,r){if(e&&e.length>0&&t&&void 0!==r)for(var a=0;a<e.length;a++)if(e[a][t]&&e[a][t]==r)return e[a];return null}static getObjectIndex(e,t,r){if(e&&e.length>0&&t&&void 0!==r)for(var a=0;a<e.length;a++)if(e[a][t]==r)return a;return-1}static getArrayOfObjectsByProperty(e,t,r){var a=[];if(e&&e.length>0&&r&&r.length>0)for(var s=0;s<r.length;s++){var n=this.getObjectByProperty(e,t,r[s]);n&&a.push(n)}return a}static getHierarchyObjectByValue(e,t,r){let a=this.flattenHierarchy(e,"children");for(let e=0;e<a.length;e++)if(a[e][t]&&a[e][t]==r)return a[e];return null}static getHierarchyObjectsByProperty(e,t,r){if(r=r||[],e&&(e[t]&&r.indexOf(e)<0&&r.push(e),e.children))for(var a=0;a<e.children.length;a++)this.getHierarchyObjectsByProperty(e.children[a],t,r);return r}static flattenHierarchy(e,t,r){if(r||(r=[]),-1==r.indexOf(e)&&r.push(e),e[t])for(var a=0;a<e[t].length;a++)r=this.flattenHierarchy(e[t][a],t,r);return r}}class s{static setMaterialAsParallax(e){let t=this._worldposReplace,r=this._envmapPhysicalParsReplace;e.onBeforeCompile=function(a){e.cubeMapPos=e.cubeMapPos?e.cubeMapPos:new v.ThreeObject.Vector3(0,0,0),e.cubeMapSize=e.cubeMapSize?e.cubeMapSize:new v.ThreeObject.Vector3(1,1,1),e.flipEnvMap=!0,a.uniforms.cubeMapSize={value:e.cubeMapSize},a.uniforms.cubeMapPos={value:e.cubeMapPos},a.uniforms.flipEnvMap.value=e.flipEnvMap,a.vertexShader="varying vec3 vWorldPosition;\n"+a.vertexShader,a.vertexShader=a.vertexShader.replace("#include <worldpos_vertex>",t),a.fragmentShader=a.fragmentShader.replace("#include <envmap_physical_pars_fragment>",r)}}static get _worldposReplace(){return"\n\t\t\t#define BOX_PROJECTED_ENV_MAP\n\n\t\t\t#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\t\t\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t\t\t\t#ifdef BOX_PROJECTED_ENV_MAP\n\n\t\t\t\t\tvWorldPosition = worldPosition.xyz;\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n            "}static get _envmapPhysicalParsReplace(){return"\n\t\t\t#if defined( USE_ENVMAP )\n\n\t\t\t\t#define BOX_PROJECTED_ENV_MAP\n\n\t\t\t\t#ifdef BOX_PROJECTED_ENV_MAP\n\n\t\t\t\t\tuniform vec3 cubeMapSize;\n\t\t\t\t\tuniform vec3 cubeMapPos;\n\t\t\t\t\tvarying vec3 vWorldPosition;\n\n\t\t\t\t\tvec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {\n\n\t\t\t\t\t\tvec3 nDir = normalize( v );\n\t\t\t\t\t\tvec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n\t\t\t\t\t\tvec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n\n\t\t\t\t\t\tvec3 rbminmax;\n\t\t\t\t\t\trbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;\n\t\t\t\t\t\trbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;\n\t\t\t\t\t\trbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;\n\n\t\t\t\t\t\tfloat correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );\n\t\t\t\t\t\tvec3 boxIntersection = vWorldPosition + nDir * correction;\n\n\t\t\t\t\t\treturn boxIntersection - cubePos;\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef ENVMAP_MODE_REFRACTION\n\t\t\t\t\tuniform float refractionRatio;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\t\t\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t\t\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\t\t\t\t#ifdef BOX_PROJECTED_ENV_MAP\n\n\t\t\t\t\t\t\tworldNormal = parallaxCorrectNormal( worldNormal, cubeMapSize, cubeMapPos );\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t\t\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\t\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t\t\t\t}\n\n\t\t\t\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\t\t\t\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\t\t\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\t\t\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\t\t\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t\t\t\t// clamp to allowable LOD ranges.\n\t\t\t\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t\t\t\t}\n\n\t\t\t\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\t\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\t\t\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t\t\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\t\t\t\t#ifdef BOX_PROJECTED_ENV_MAP\n\t\t\t\t\t\t\treflectVec = parallaxCorrectNormal( reflectVec, cubeMapSize, cubeMapPos );\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t\t\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\t\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\n\t\t\t\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\t\t\t\t\tvec2 sampleUV;\n\t\t\t\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\t\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t\t\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\t\t\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\n\t\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t\t\t}\n\t\t\t#endif\n            "}}class n{static generateMaterials(e,t){for(var r=[],a=0;a<e.length;a++){var s=this.generateMaterial(e[a],t);s&&r.push(s)}return r}static generateMaterial(e,t){var r;switch(e.type){case 0:r=new v.ThreeObject.MeshBasicMaterial;break;case 1:r=new v.ThreeObject.MeshMatcapMaterial;break;case 2:r=new v.ThreeObject.MeshStandardMaterial;break;case 3:r=new v.ThreeObject.MeshPhysicalMaterial;break;case 4:r=new v.ThreeObject.MeshPhongMaterial;break;case 5:r=new v.ThreeObject.MeshLambertMaterial}if(r)return r.matId=e.id,r.name=e.name,r.materialSide=e.side,r.side=0==r.materialSide?v.ThreeObject.FrontSide:1==r.materialSide?v.ThreeObject.BackSide:2==r.materialSide?v.ThreeObject.DoubleSide:v.ThreeObject.FrontSide,e.properties&&(0!=e.type&&(1==e.properties._useParallaxMapping&&s.setMaterialAsParallax(r),e.properties._LightMap&&(r.lightMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._LightMap)),e.properties._OcclusionMap&&(r.aoMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._OcclusionMap)),e.properties._EmissionMap&&(r.emissiveMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._EmissionMap)),e.properties._EmissionColor&&(r.emissive=new v.ThreeObject.Color(e.properties._EmissionColor[0],e.properties._EmissionColor[1],e.properties._EmissionColor[2])),e.properties._BumpMap&&(r.normalMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._BumpMap)),e.properties._Illum&&(r.emissiveMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._Illum),r.emissive=new v.ThreeObject.Color(1,1,1)),e.properties._MetalnessMap&&(r.metalnessMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._MetalnessMap)),e.properties._RoughnessMap&&(r.roughnessMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._RoughnessMap)),e.properties._NormalMap&&(r.normalMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._NormalMap))),e.properties._Cube&&(r.envMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._Cube),r.metalness=1),e.properties._ReflectColor&&(r.envMapIntensity=e.properties._ReflectColor[3]),e.properties._Color&&(r.color=new v.ThreeObject.Color(e.properties._Color[0],e.properties._Color[1],e.properties._Color[2])),e.properties._Metallic&&(r.metalness=e.properties._Metallic),e.properties._Roughness&&(r.roughness=e.properties._Roughness),e.properties._MainTex&&(r.map=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._MainTex)),e.properties.transparency&&(r.transparent=e.properties.transparency<1,r.opacity=e.properties.transparency),e.properties.transparentMap&&(r.transparent=!0,r.alphaMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties.transparentMap)),e.properties.specularMap&&(r.roughnessMap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties.specularMap)),e.properties._BumpScale&&(r.bumpMapScale=e.properties._BumpScale),e.properties._MatCap&&(r.matcap=a.getObjectByProperty(t.generatedAssets.textures,"texID",e.properties._MatCap)),r.morphTargets=!0),r}static disposeMaterial(e){e.dispose&&e.constructor===Function&&e.dispose()}}class i{static generateMeshGeometry(e){var t;if(e.geometry){var r=this.generateGeometry(e.name,e.geometry.vertices,e.geometry.normals,e.geometry.uv,e.geometry.faces);if((t=new v.ThreeObject.BufferGeometry).setAttribute("position",new v.ThreeObject.BufferAttribute(new Float32Array(r.vertices),3)),r.normals.length>0&&t.setAttribute("normal",new v.ThreeObject.BufferAttribute(new Float32Array(r.normals),3)),r.uvs.length>0)for(var a=0;a<r.uvs.length;a++){var s=a>0?a+1:"";t.setAttribute("uv"+s,new v.ThreeObject.BufferAttribute(new Float32Array(r.uvs[a]),2))}var n=0;for(a=0;a<e.geometry.faces.length;a++)t.addGroup(n,e.geometry.faces[a].length,a),n+=e.geometry.faces[a].length}return e.id&&(t.meshID=e.id),e.name&&(t.name=e.name),e.geometry.castShadows&&(t.castShadow=e.geometry.castShadows),e.geometry.recieveShadows&&(t.receiveShadow=e.geometry.recieveShadows),t}static generateGeometry(e,t,r,a,s){for(var n={name:"",vertices:[],normals:[],uvs:[]},i=0;i<s.length;i++)for(var o=0;o<s[i].length;o++){var l=3*((p=parseInt(s[i][o]))>=0?p:p+t.length/3),c=3*(p>=0?p:p+r.length/3);n.vertices.push(t[l],t[l+1],t[l+2]),n.normals.push(r[c],r[c+1],r[c+2])}1==a.length&&a.push(a[0]),a.length>1&&a[0].length!=a[1].length&&(a[1]=a[0]);for(i=0;i<a.length;i++){n.uvs.push([]);for(o=0;o<s.length;o++)for(var u=0;u<s[o].length;u++){var p,m=2*((p=parseInt(s[o][u]))>=0?p:p+a[i].length/2);n.uvs[i].push(a[i][m],a[i][m+1])}}return n.name=e,n}static flipGeometryArray(e){const t=[0,0,0];for(let r=0;r<e.length/9;r++)t[0]=e[9*r],t[1]=e[9*r+1],t[2]=e[9*r+2],e[9*r]=e[9*r+6],e[9*r+1]=e[9*r+7],e[9*r+2]=e[9*r+8],e[9*r+6]=t[0],e[9*r+7]=t[1],e[9*r+8]=t[2];return e}static flipUV(e){const t=[0,0];for(let r=0;r<e.length/6;r++)t[0]=e[6*r],t[1]=e[6*r+1],e[6*r]=e[6*r+4],e[6*r+1]=e[6*r+5],e[6*r+4]=t[0],e[6*r+5]=t[1];return e}static combineGeometry(e){let t=e.items,r=new v.ThreeObject.BufferGeometry,a=new Float32Array(e.posSize),s=new Float32Array(e.normSize),n=new Float32Array(e.uv1Size),i=new Float32Array(e.uv2Size),o=0,l=0,c=0,u=0;for(let e=0;e<t.length;e++){let r=t[e].geometry.getAttribute("position").array.slice(),g=t[e].geometry.getAttribute("normal").array.slice(),f=t[e].geometry.getAttribute("uv").array.slice(),b=t[e].geometry.getAttribute("uv2")?t[e].geometry.getAttribute("uv2").array.slice():f;t[e].geometry.applyMatrix4(t[e].matrix),t[e].geometry.verticesNeedUpdate=!0;var p=t[e].geometry.getAttribute("position").array;p=t[e].flipped?this.flipGeometryArray(p):p;for(let e=0;e<p.length;e++)a[e+o]=p[e],p[e]=r[e];o+=p.length;var m=t[e].geometry.getAttribute("normal").array;m=t[e].flipped?this.flipGeometryArray(m):m;for(let e=0;e<m.length;e++)s[e+l]=m[e],m[e]=g[e];l+=m.length;var d=t[e].geometry.getAttribute("uv").array;d=t[e].flipped?this.flipUV(d):d;for(let e=0;e<d.length;e++)n[e+c]=d[e],d[e]=f[e];c+=d.length;var h=t[e].geometry.getAttribute("uv2")?t[e].geometry.getAttribute("uv2").array:t[e].geometry.getAttribute("uv").array;h=t[e].flipped?this.flipUV(h):h;for(let e=0;e<h.length;e++)i[e+u]=h[e],h[e]=b[e];u+=h.length,t[e].geometry.verticesNeedUpdate=!0}return r.setAttribute("position",new v.ThreeObject.BufferAttribute(a,3)),r.setAttribute("normal",new v.ThreeObject.BufferAttribute(s,3)),r.setAttribute("uv",new v.ThreeObject.BufferAttribute(n,2)),r.setAttribute("uv2",new v.ThreeObject.BufferAttribute(i,2)),r.meshID=e.id+"-"+e.material.matId,r.addGroup(0,a.length,0),r}}class o{static generateSkeletonByID(e,t){if(e.skin&&e.skin.bones){t.skeletons||(t.skeletons={});var r=a.getObjectByProperty(t.assets.bones,"id",e.skin.bones);return t.skeletons[e.skin.bones]||(t.skeletons[e.skin.bones]=this.generateSkeleton(r)),t.skeletons[e.skin.bones]}}static generateSkinData(e){for(var t=[],r=[],a=[],s=[],n=0;n<e.geometry.faces.length;n++)for(var i=0;i<e.geometry.faces[n].length;i++){var o=parseInt(e.geometry.faces[n][i]),l=4*(o>=0?o:o+e.skin.skinWeights.length/4),c=4*(o>=0?o:o+r.length/4);t.push(e.skin.skinWeights[l],e.skin.skinWeights[l+1],e.skin.skinWeights[l+2],e.skin.skinWeights[l+3]),r.push(e.skin.skinIndices[c],e.skin.skinIndices[c+1],e.skin.skinIndices[c+2],e.skin.skinIndices[c+3])}if(t&&t.length>0)for(var u=0,p=t.length;u<p;u+=4){var m=t[u],d=void 0!==t[u+1]?t[u+1]:0,h=void 0!==t[u+2]?t[u+2]:0,g=void 0!==t[u+3]?t[u+3]:0;a.push(m,d,h,g)}if(r&&r.length>0)for(u=0,p=r.length;u<p;u+=4){var f=r[u],b=r[u+1],y=r[u+2],O=r[u+3];s.push(f,b,y,O)}return{weights:new v.ThreeObject.Float32BufferAttribute(a,4),indices:new v.ThreeObject.Uint16BufferAttribute(s,4)}}static generateSkeleton(e){for(var t=[],r=null,a=e.bones,s=0;s<a.length;s++){var n=new v.ThreeObject.Bone;n.boneID=a[s].id,n.name=a[s].name,n.parentIndex=a[s].parent,n.position.set(a[s].pos[0],a[s].pos[1],a[s].pos[2]),n.scale.set(a[s].scl[0],a[s].scl[1],a[s].scl[2]),n.quaternion.set(a[s].rotq[0],a[s].rotq[1],a[s].rotq[2],a[s].rotq[3]),t.push(n)}for(s=0;s<t.length;s++)t[s].parentIndex>=0?t[t[s].parentIndex].add(t[s]):r=t[s];var i=new v.ThreeObject.Skeleton(t);return i.skeletonID=e.id,i.root=r,i}static generateSkin(e,t){var r=this.generateSkinData(t);e.setAttribute("skinIndex",r.indices),e.setAttribute("skinWeight",r.weights)}static generateBlendShapeData(e,t){var r=t.morph.blendShapes;e.morphAttributes.position=[];for(var a=0;a<r.length;a++){var s=Geometry.generateGeometry(r[a].name,r[a].vertices,t.geometry.normals,t.geometry.uv,t.geometry.faces),n=new v.ThreeObject.Float32BufferAttribute(s.vertices,3);n.name=r[a].name,e.morphAttributes.position[a]=n}return e}}class l{static parseGeometries(e,t){var r=[];if(e)for(var a=0;a<e.length;a++)if(e[a]){var s=i.generateMeshGeometry(e[a]),n=o.generateSkeletonByID(e[a],t);e[a].skin&&o.generateSkin(s,e[a]),e[a].morph,n&&(s.bones=n),r.push(s)}return r}static createMeshByGeometryID(e,t,r){var s,n,i=[],o=a.getObjectByProperty(r.geometries,"meshID",e);if(t){for(var l=0;l<t.length;l++){var c=a.getObjectByProperty(r.materials,"matId",t[l]);c&&i.push(c)}n=i.length>1?i:i[0]}return o&&(s=0==o.hasMorph&&0==o.hasSkin?new v.ThreeObject.Mesh(o,n):new v.ThreeObject.SkinnedMesh(o,n),o.receiveShadow&&(s.receiveShadow=o.receiveShadow),o.castShadow&&(s.castShadow=o.castShadow)),s}static createMeshByGeometryID2(e,t,r){var s,n,i=[],o=a.getObjectByProperty(r.geometries,"meshID",e);if(t){for(var l=0;l<t.length;l++){var c=a.getObjectByProperty(r.materials,"matId",t[l]);c&&i.push(c)}n=i.length>1?i:i[0]}return o&&(s=0==o.hasMorph&&0==o.hasSkin?new v.ThreeObject.Mesh(o,n):new v.ThreeObject.SkinnedMesh(o,n),o.receiveShadow&&(s.receiveShadow=o.receiveShadow),o.castShadow&&(s.castShadow=o.castShadow)),s}}class c{static generateTexture(e){if(e&&e.textureData&&e.textureData.length>0&&e.textureData[0]){var t=e.textureData[0].data?e.textureData[0].data:e.textureData[0],r=new v.ThreeObject.Texture;return r.texID=e.id,r.name=e.name,r.image=t,r.wrapS=v.ThreeObject.RepeatWrapping,r.wrapT=v.ThreeObject.RepeatWrapping,r.repeat.set(1,1),r.usedImages=[r.image],r.needsUpdate=!0,r}}static generateCubeTexture(e){if(e&&e.textureData&&e.textureData.length>0){var t=new v.ThreeObject.CubeTexture;t.texID=e.id,t.name=e.name,t.images=[],t.usedImages=t.images,t.needsUpdate=!0;for(var r=0;r<e.textureData.length;r++)t.images.push(e.textureData[r].data);return t}}static disposeTexture(e){e.dispose&&e.constructor===Function&&e.dispose()}static disposeImage(e){e.src&&(e.src="")}}var u={None:0,Scene:1,Object3D:2,AnimationObject:3,Object:4,Bone:5,SpotLight:6,DirectionalLight:7,PointLight:8,AreaLight:9,PerspectiveCamera:10,OrthographicCamera:11,SkinnedMesh:12,Mesh:13};class p{static radians(e){return e*Math.PI/180}static degrees(e){return 180*e/Math.PI}}class m{static setLightData(e,t){e.color=new v.ThreeObject.Color(t.color[0],t.color[1],t.color[2]),e.intensity=t.intensity,e.distance=100*t.range,e.angle=p.radians(t.angle),e.castShadow=t.shadow,e.lightID=t.lightID}}class d{static setAnimationData(e,t){if(t&&e){var r=a.getObjectByProperty(t.assets.animations,"id",e.animationID);if(r){e.objects=a.flattenHierarchy(e,"children");var s=this.generateAnimation(e,r);if(s&&s.clips&&s.clips.length>0){var n=this.setAnimation(e,s);return n.id=s.id,{mixer:n,clips:s.clips}}}}return null}static generateAnimation(e,t){if(t.clips){for(var r={id:t.id,clips:[]},a=0;a<t.clips.length;a++)r.clips.push(this.generateAnimationClip(e,t.clips[a]));return r}}static parseClipData(e,t,r){for(var a={},s=[],n=Object.keys(r).sort(),i=0;i<n.length;i++){var o=r[n[i]];if(o.blendShape)for(var l in a.morphTargetInfluences||(a.morphTargetInfluences={}),o.blendShape)a.morphTargetInfluences[l]||(a.morphTargetInfluences[l]={times:[],arr:[],class:v.ThreeObject.NumberKeyframeTrack}),a.morphTargetInfluences[l].arr.push(o.blendShape[l]/100),a.morphTargetInfluences[l].times.push(Number.parseFloat(n[i]));o.m_LocalPosition&&(a.position||(a.position={times:[],arr:[],class:v.ThreeObject.VectorKeyframeTrack}),a.position.arr.push(o.m_LocalPosition.x,o.m_LocalPosition.y,o.m_LocalPosition.z),a.position.times.push(Number.parseFloat(n[i]))),o.m_LocalRotation&&(a.quaternion||(a.quaternion={times:[],arr:[],class:v.ThreeObject.QuaternionKeyframeTrack}),a.quaternion.arr.push(o.m_LocalRotation.x,o.m_LocalRotation.y,o.m_LocalRotation.z,o.m_LocalRotation.w),a.quaternion.times.push(Number.parseFloat(n[i]))),o.m_LocalScale&&(a.scale||(a.scale={times:[],arr:[],class:v.ThreeObject.VectorKeyframeTrack}),a.scale.arr.push(o.m_LocalScale.x,o.m_LocalScale.y,o.m_LocalScale.z),a.scale.times.push(Number.parseFloat(n[i]))),s.push(Number.parseFloat(n[i]))}for(var c in a)if(a[c].class)a[c]=new a[c].class(e+"."+c,a[c].times,a[c].arr);else for(var u in a[c])a[c][u]&&(a[c]=new a[c][u].class(t+"."+c+"["+u+"]",a[c][u].times,a[c][u].arr));return{time:s[s.length-1],obj:a}}static generateAnimationClip(e,t){for(var r=[],s=0;s<t.hierarchy.length;s++){var n=e.objects[t.hierarchy[s].index].name==t.hierarchy[s].name?t.hierarchy[s].index:a.getObjectIndex(e.objects,"name",t.hierarchy[s].name),i=".objects["+n+"]";if(n>=0){var o=t.hierarchy[s].name,l=this.parseClipData(i,o,t.hierarchy[s].keys);r=r.concat(Object.values(l.obj))}}var c=new v.ThreeObject.AnimationClip(t.name,t.length,r);return c.id=t.id,c.mode=t.mode,c}static setAnimation(e,t){var r=new v.ThreeObject.AnimationMixer(e);if(t.clips&&t.clips.length>0){r.clips={};for(var a=0;a<t.clips.length;a++)t.clips[a]&&(r.clips[t.clips[a].name]=r.clipAction(t.clips[a],e),r.clips[t.clips[a].name].id=t.clips[a].id,r.clips[t.clips[a].name].name=t.clips[a].name,r.clips[t.clips[a].name].mode=this.loopMode(t.clips[a].mode),r.clips[t.clips[a].name].duration=t.clips[a].duration,r.clips[t.clips[a].name].setEffectiveWeight(1))}return r}static loopMode(e){return"Once"==e?v.ThreeObject.LoopOnce:"PingPong"==e?v.ThreeObject.LoopPingPong:v.ThreeObject.LoopRepeat}}class h{static getCombinedObjectsInfo(e,t,r,s,n){t=t||new v.ThreeObject.Object3D,s=s||{};let i=e.matrixWorld.clone();if(r.children)for(var o=0;o<r.children.length;o++){e.position.set(0,0,0),e.quaternion.set(0,0,0,0),e.scale.set(1,1,1),e.applyMatrix4(i),e.updateMatrixWorld(!0);let l=r.children[o],c=null,u=null;if(t&&(e.add(t),t.position.set(0,0,0),t.quaternion.set(0,0,0,0),t.scale.set(1,1,1)),l.materials&&l.materials[0]){let e=l.materials[0];if(!s[e]){let t=a.getArrayOfObjectsByProperty(n.generatedAssets.materials,"matId",r.children[o].materials);s[e]={material:t[0],items:[],posSize:0,normSize:0,uv1Size:0,uv2Size:0}}c=s[e]}if(l.transform&&!r.containsReference&&(l.transform.position&&t.position.set(l.transform.position[0],l.transform.position[1],l.transform.position[2]),l.transform.rotation&&t.quaternion.set(l.transform.rotation[0],l.transform.rotation[1],l.transform.rotation[2],l.transform.rotation[3]),l.transform.scale&&t.scale.set(l.transform.scale[0],l.transform.scale[1],l.transform.scale[2])),l.meshID&&(t.geometry=a.getObjectByProperty(n.generatedAssets.geometries,"meshID",l.meshID)),t.updateMatrixWorld(!0),u=t.matrixWorld.clone(),c&&t.geometry){let e={geometry:t.geometry,posSize:t.geometry.attributes.position.array.length,normSize:t.geometry.attributes.normal.array.length,uv1Size:t.geometry.attributes.uv.array.length,uv2Size:t.geometry.attributes.uv2?t.geometry.attributes.uv2.array.length:t.geometry.attributes.uv.array.length,matrix:u};c.posSize+=e.posSize,c.normSize+=e.normSize,c.uv1Size+=e.uv1Size,c.uv2Size+=e.uv2Size,c.items.push(e)}e.position.set(0,0,0),e.quaternion.set(0,0,0,0),e.scale.set(1,1,1),e.applyMatrix4(u),e.updateMatrixWorld(!0),this.getCombinedObjectsInfo(e,t,l,s,n)}return t.parent&&t.parent.remove(t),s}static getObjectsInfo2(e,t,r,s,n){t=t||new v.ThreeObject.Object3D,s=s||{};let i=e.matrixWorld.clone();if(r.children)for(var o=0;o<r.children.length;o++){e.position.set(0,0,0),e.quaternion.set(0,0,0,0),e.scale.set(1,1,1),e.applyMatrix4(i),e.updateMatrixWorld(!0);let l=r.children[o],c=null,u=null;if(t&&(e.add(t),t.position.set(0,0,0),t.quaternion.set(0,0,0,0),t.scale.set(1,1,1)),l.materials&&l.materials[0]){let e=l.materials[0];if(!s[e]){let t=a.getArrayOfObjectsByProperty(n.generatedAssets.materials,"matId",r.children[o].materials);s[e]={material:t[0],items:[],posSize:0,normSize:0,uv1Size:0,uv2Size:0}}c=s[e]}if(l.transform&&!r.containsReference&&(l.transform.position&&t.position.set(l.transform.position.x,l.transform.position.y,l.transform.position.z),l.transform.rotation&&t.quaternion.set(l.transform.rotation.x,l.transform.rotation.y,l.transform.rotation.z,l.transform.rotation.w),l.transform.scale&&t.scale.set(l.transform.scale.x,l.transform.scale.y,l.transform.scale.z)),l.meshID&&(t.geometry=a.getObjectByProperty(n.generatedAssets.geometries,"meshID",l.meshID)),t.updateMatrixWorld(!0),u=t.matrixWorld.clone(),c&&t.geometry){let e={geometry:t.geometry,posSize:t.geometry.attributes.position.array.length,normSize:t.geometry.attributes.normal.array.length,uv1Size:t.geometry.attributes.uv.array.length,uv2Size:t.geometry.attributes.uv2?t.geometry.attributes.uv2.array.length:t.geometry.attributes.uv.array.length,matrix:u};c.posSize+=e.posSize,c.normSize+=e.normSize,c.uv1Size+=e.uv1Size,c.uv2Size+=e.uv2Size,c.items.push(e)}e.position.set(0,0,0),e.quaternion.set(0,0,0,0),e.scale.set(1,1,1),e.applyMatrix4(u),e.updateMatrixWorld(!0)}return t.parent&&t.parent.remove(t),s}static getObjectsInfo2(e,t,r){let a=new v.ThreeObject.Vector3,s={},n=e.parent;e.updateMatrixWorld(!0);let i=e.matrixWorld.clone();n&&n.remove(e),e.matrixWorld.identity(),e.updateMatrixWorld(!0);for(var o=0;o<t.length;o++){let n=null,i=null,l=t[o],c=l.parent,u=null!=r&&null!=r?r:l.material[0];l.getWorldScale(a);let p=a.x<0,m=a.y<0,d=a.z<0,h=a.x<0||a.y<0||a.z<0;if(l.updateMatrixWorld(!0),i=l.matrixWorld.clone(),e.add(l),l.matrixWorld.copy(i),l.updateMatrixWorld(!0),s[u.uuid]||(s[u.uuid]={material:u,items:[],posSize:0,normSize:0,uv1Size:0,uv2Size:0}),(n=s[u.uuid])&&l.geometry){let e={geometry:l.geometry,posSize:l.geometry.attributes.position.array.length,normSize:l.geometry.attributes.normal.array.length,uv1Size:l.geometry.attributes.uv.array.length,uv2Size:l.geometry.attributes.uv2?l.geometry.attributes.uv2.array.length:l.geometry.attributes.uv.array.length,matrix:i,flippedX:p,flippedY:m,flippedZ:d,flipped:h};n.posSize+=e.posSize,n.normSize+=e.normSize,n.uv1Size+=e.uv1Size,n.uv2Size+=e.uv2Size,n.items.push(e)}c.add(l),l.matrixWorld.copy(i),l.updateMatrixWorld(!0)}return n&&n.add(e),e.matrixWorld.copy(i),e.updateMatrixWorld(!0),s}static getObjectsInfo3(e,t,r){let a=new v.ThreeObject.Vector3,s={},n=e.parent;e.updateMatrixWorld(!0);let i=e.matrixWorld.clone();n&&n.remove(e),e.matrixWorld.identity(),e.updateMatrixWorld(!0);for(var o=0;o<t.length;o++){let n=null,i=null,l=t[o],c=l.parent,u=null!=r&&null!=r?r:l.material[0];l.getWorldScale(a);let p=a.x<0,m=a.y<0,d=a.z<0,h=a.x<0||a.y<0||a.z<0;if(l.updateMatrixWorld(!0),i=l.matrixWorld.clone(),e.add(l),l.matrixWorld.copy(i),l.updateMatrixWorld(!0),s[u.uuid]||(s[u.uuid]={material:u,items:[],posSize:0,normSize:0,uv1Size:0,uv2Size:0}),(n=s[u.uuid])&&l.geometry){let e={geometry:l.geometry,posSize:l.geometry.attributes.position.array.length,normSize:l.geometry.attributes.normal.array.length,uv1Size:l.geometry.attributes.uv.array.length,uv2Size:l.geometry.attributes.uv2?l.geometry.attributes.uv2.array.length:l.geometry.attributes.uv.array.length,matrix:i,flippedX:p,flippedY:m,flippedZ:d,flipped:h};n.posSize+=e.posSize,n.normSize+=e.normSize,n.uv1Size+=e.uv1Size,n.uv2Size+=e.uv2Size,n.items.push(e)}c.add(l),l.matrixWorld.copy(i),l.updateMatrixWorld(!0)}return n&&n.add(e),e.matrixWorld.copy(i),e.updateMatrixWorld(!0),s}static getObjectsInfo(e,t){let r=new v.ThreeObject.Vector3,a={};for(var s=0;s<e.length;s++){e[s].getWorldScale(r);let n=null,i=e[s],o=null!=t&&null!=t?t:i.material[0],l=r.x<0||r.y<0||r.z<0;if(i.updateMatrix(),i.updateMatrixWorld(!0),a[o.uuid]||(a[o.uuid]={material:o,items:[],posSize:0,normSize:0,uv1Size:0,uv2Size:0}),(n=a[o.uuid])&&i.geometry){let e={geometry:i.geometry,posSize:i.geometry.attributes.position.array.length,normSize:i.geometry.attributes.normal.array.length,uv1Size:i.geometry.attributes.uv.array.length,uv2Size:i.geometry.attributes.uv2?i.geometry.attributes.uv2.array.length:i.geometry.attributes.uv.array.length,matrix:i.matrixWorld,flipped:l};n.posSize+=e.posSize,n.normSize+=e.normSize,n.uv1Size+=e.uv1Size,n.uv2Size+=e.uv2Size,n.items.push(e)}}return a}static getAllMeshes(e,t){if(t=t||[],e)for(let r=0;r<e.length;r++)e[r]&&(e[r].geometry&&t.push(e[r]),this.getAllMeshes(e[r].children,t));return t}static combineGeometries(e,t,r){t=t||new v.ThreeObject.Object3D;let a=this.getAllMeshes(e),s=this.getObjectsInfo(a,r);for(let e in s){let r=i.combineGeometry(s[e]),a=new v.ThreeObject.Mesh(r,s[e].material);a.isCombinedMesh=!0,t.add(a)}return t}static combineObjectsAsOne(e,t){if(t){let r=this.getAllMeshes(e),a=this.getObjectsInfo(r,t);for(let e in a){let t=i.combineGeometry(a[e]);return new v.ThreeObject.Mesh(t,a[e].material)}}return null}static combineObjectGeometries(e,t){if(e.children&&(!e.flags||1!=e.flags.combineMeshes))for(var r=0;r<e.children.length;r++)this.combineObjectGeometries(e.children[r],t);if(e.flags&&1==e.flags.combineMeshes){let r=this.createObject(e,t),a=this.getCombinedObjectsInfo(r,null,e,null,t);e.flags.combineMeshes=!1,e.children=[];for(let r in a){a[r].id=e.id;let s=i.combineGeometry(a[r]),n={name:a[r].material.name,type:u.Mesh,materials:[a[r].material.matId],meshID:s.meshID};t.generatedAssets.geometries.push(s),e.children.push(n)}}}}class g{static createListener(e){let t=new v.ThreeObject.AudioListener;return e&&e.add(t),t}static createSource(e,t,r){var a=new v.ThreeObject.PositionalAudio(e);return a.setBuffer(t.clip.dataBuffer),a.setRefDistance(t.spread),a.loop=t.loop,a.sourceID=t.id,a.name=t.clip.name,a.autoplay=t.autoPlay,a.setVolume(1==t.mute?0:1),1==t.autoPlay&&a.play(),r.sound=a,r.add(r.sound),a}static disposeSoundSource(e){1==e.isPlaying&&e.stop(),e.parent&&e.parent.remove(e)}static disposeSoundListener(e){e.parent&&e.parent.remove(e)}}class f{static generateObject(e,t){var r=this.createObject(this.getHierarchyObjectByPath(e.objects,t),e);return this.addObjectsToBones(r,e),this.postAttachProperties(r,e),e.tempData&&(e.tempData.audio&&(r.audioListener=e.tempData.audio.listener,r.audioSources=e.tempData.audio.objects),delete e.tempData),this.setAdditionalFunctionality(r),e.skeletons={},r}static getHierarchyObjectByPath(e,t){if((t=t&&t.length>0?t:"").length>0){let s=t.split("/");for(var r=e,a=0;a<s.length;a++)r&&(r=this.getHierarchyObjectByName(r,s[a]));return r}return e}static getHierarchyObjectByName(e,t){if(e){if(e.name==t)return e;if(e.children)for(var r=0;r<e.children.length;r++)if(e.children[r].name==t)return e.children[r]}return null}static addObjectsToBones(e,t){for(var r=a.flattenHierarchy(e,"children"),s=0;s<r.length;s++)if(null!=r[s].parentBone)for(var n=0;n<r.length;n++)if(r[n].boneID==r[s].parentBone){r[n].add(r[s]);break}}static createObject(e,t,r){var a=this.getClassByType(e.type);if(a){var s=new a;if(e.id&&(s.loziID=e.id),e.parentBoneId&&(s.parentBone=e.parentBoneId),e.name&&(s.name=e.name),e.transform&&!r&&(e.transform.position&&s.position.set(e.transform.position[0],e.transform.position[1],e.transform.position[2]),e.transform.rotation&&s.quaternion.set(e.transform.rotation[0],e.transform.rotation[1],e.transform.rotation[2],e.transform.rotation[3]),e.transform.scale&&s.scale.set(e.transform.scale[0],e.transform.scale[1],e.transform.scale[2])),(!e.flags||1!=e.flags.combineMeshes)&&(this.setProperties(s,e,t),e.children))for(var n=0;n<e.children.length;n++){var i=this.createObject(e.children[n],t,e.containsReference);i&&s.add(i)}return s}}static setAdditionalFunctionality(e){e.getObjectByPath=t=>this.getHierarchyObjectByPath(e,t),e.playAudio=(t,r)=>{if(r=void 0!==r?r:1,e.audioSources)for(let a=0;a<e.audioSources.length;a++)e.audioSources[a].name==t&&(e.audioSources[a].play(),e.audioSources[a].setVolume(r))},e.stopAudio=t=>{if(e.audioSources)for(let r=0;r<e.audioSources.length;r++)e.audioSources[r].name==t&&e.audioSources[r].source&&e.audioSources[r].stop()},e.stopAllAudios=t=>{if(e.audioSources)for(let t=0;t<e.audioSources.length;t++)e.audioSources[t].source&&e.audioSources[t].stop()},e.setVolumeOnAllSources=t=>{if(e.audioSources)for(let r=0;r<e.audioSources.length;r++)e.audioSources[r].source&&e.audioSources[r].setVolume(t)},e.pauseAudio=t=>{if(e.audioSources)for(let r=0;r<e.audioSources.length;r++)e.audioSources[r].name==t&&e.audioSources[r].pause()}}static getCombinedObjectsInfo(e,t,r,s,n){t=t||new v.ThreeObject.Object3D,s=s||{};let i=e.matrixWorld.clone();if(r.children)for(var o=0;o<r.children.length;o++){e.position.set(0,0,0),e.quaternion.set(0,0,0,0),e.scale.set(1,1,1),e.applyMatrix4(i),e.updateMatrixWorld(!0);let l=r.children[o],c=null,u=null;if(t&&(e.add(t),t.position.set(0,0,0),t.quaternion.set(0,0,0,0),t.scale.set(1,1,1)),l.materials&&l.materials[0]){let e=l.materials[0];if(!s[e]){let t=a.getArrayOfObjectsByProperty(n.generatedAssets.materials,"matId",r.children[o].materials);s[e]={material:t[0],items:[],posSize:0,normSize:0,uv1Size:0,uv2Size:0}}c=s[e]}if(l.transform&&!r.containsReference&&(l.transform.position&&t.position.set(l.transform.position[0],l.transform.position[1],l.transform.position[2]),l.transform.rotation&&t.quaternion.set(l.transform.rotation[0],l.transform.rotation[1],l.transform.rotation[2],l.transform.rotation[3]),l.transform.scale&&t.scale.set(l.transform.scale[0],l.transform.scale[1],l.transform.scale[2])),l.meshID&&(t.geometry=a.getObjectByProperty(n.generatedAssets.geometries,"meshID",l.meshID)),t.updateMatrixWorld(!0),u=t.matrixWorld.clone(),c&&t.geometry){let e={geometry:t.geometry,posSize:t.geometry.attributes.position.array.length,normSize:t.geometry.attributes.normal.array.length,uv1Size:t.geometry.attributes.uv.array.length,uv2Size:t.geometry.attributes.uv2?t.geometry.attributes.uv2.array.length:t.geometry.attributes.uv.array.length,matrix:u};c.posSize+=e.posSize,c.normSize+=e.normSize,c.uv1Size+=e.uv1Size,c.uv2Size+=e.uv2Size,c.items.push(e)}e.position.set(0,0,0),e.quaternion.set(0,0,0,0),e.scale.set(1,1,1),e.applyMatrix4(u),e.updateMatrixWorld(!0),this.getCombinedObjectsInfo(e,t,l,s,n)}return t.parent&&t.parent.remove(t),s}static setProperties(e,t,r){if(t.meshID){if(e.meshGeometryID=t.meshID,e.geometry=a.getObjectByProperty(r.generatedAssets.geometries,"meshID",t.meshID),e.material=a.getArrayOfObjectsByProperty(r.generatedAssets.materials,"matId",t.materials),e.geometry.bones){e.add(e.geometry.bones.root),e.bind(e.geometry.bones);for(var s=0;s<e.material.length;s++)e.material[s].skinning=!0}for(s=0;s<e.material.length;s++)e.material[s].morphTargets=!0;e.updateMorphTargets&&e.updateMorphTargets()}t.animationID&&(e.animationID=t.animationID),t.lightData&&m.setLightData(e,t.lightData),t.sound&&(r.tempData||(r.tempData={}),r.tempData.audio||(r.tempData.audio={},r.tempData.audio.listener=g.createListener(),r.tempData.audio.objects=[]),e.sound=t.sound,e.sound.clip=a.getObjectByProperty(r.generatedAssets.sounds,"id",e.sound.clip),e.sound&&e.sound.clip&&(e.sound=g.createSource(r.tempData.audio.listener,e.sound,e),r.tempData.audio.objects.push(e.sound))),e.geometry&&(e.castShadow=0!=e.geometry.castShadow,e.receiveShadow=0!=e.geometry.receiveShadow)}static postAttachProperties(e,t){if(e){if(e.animationID){let r=d.setAnimationData(e,t);e.animation=r.mixer,e.clips=r.clips}for(var r=0;r<e.children.length;r++)this.postAttachProperties(e.children[r],t)}}static applyFlagsToObjects(e,t){this.applyObjectReferences(e,e,t),this.combineObjectGeometries(e,t)}static applyObjectReferences(e,t,r,a){if(a=a||this.flattenHierarchy(t),e.children&&(!e.flags||!e.flags.reference))for(var s=0;s<e.children.length;s++)this.applyObjectReferences(e.children[s],t,r,a);if(e.flags&&e.flags.reference){let t=a[e.flags.reference];t&&(e.children||(e.children=[]),e.children.push(t),e.containsReference=!0),e.flags.reference=null,e.flags.combineMeshes=!1}}static flattenHierarchy(e,t){if(t=t||{},e.id&&(t[e.id]||(t[e.id]=e)),e.children)for(let r=0;r<e.children.length;r++)this.flattenHierarchy(e.children[r],t);return t}static combineGeometries(e,t,r){return h.combineGeometries(e,t,r)}static combineObjectsAsOne(e,t,r){return h.combineObjectsAsOne(e,t,r)}static combineObjectGeometries(e,t){if(e.children&&(!e.flags||1!=e.flags.combineMeshes))for(var r=0;r<e.children.length;r++)this.combineObjectGeometries(e.children[r],t);if(e.flags&&1==e.flags.combineMeshes){let r=this.createObject(e,t),a=this.getCombinedObjectsInfo(r,null,e,null,t);e.flags.combineMeshes=!1,e.children=[];for(let r in a){a[r].id=e.id;let s=i.combineGeometry(a[r]),n={name:a[r].material.name,type:u.Mesh,materials:[a[r].material.matId],meshID:s.meshID};t.generatedAssets.geometries.push(s),e.children.push(n)}}}static getClassByType(e){switch(e){case u.Object:case u.Object3D:case u.AnimationObject:return v.ThreeObject.Object3D;case u.Scene:return v.ThreeObject.Scene;case u.SpotLight:return v.ThreeObject.SpotLight;case u.DirectionalLight:return v.ThreeObject.DirectionalLight;case u.PointLight:return v.ThreeObject.PointLight;case u.AreaLight:return v.ThreeObject.AmbientLight;case u.PerspectiveCamera:return v.ThreeObject.PerspectiveCamera;case u.OrthographicCamera:return v.ThreeObject.OrthographicCamera;case u.SkinnedMesh:return v.ThreeObject.SkinnedMesh;case u.Mesh:return v.ThreeObject.Mesh}}}class b{static setAnimationData(e,t){if(t&&e){var r=a.getObjectByProperty(t.assets.animations,"id",e.animationID);if(r){e.objects=a.flattenHierarchy(e,"children");var s=this.generateTransformAnimation(e,r);if(s&&s.clips&&s.clips.length>0){var n=this.setAnimation(e,s);return n.id=s.id,n}}}return null}static generateTransformAnimation(e,t){if(t.clips){for(var r={id:t.id,clips:[]},a=0;a<t.clips.length;a++)r.clips.push(this.generateTransformAnimationClip(e,t.clips[a]));return r}}static parseClipData(e,t,r){for(var a={},s=[],n=Object.keys(r).sort(),i=0;i<n.length;i++){var o=r[n[i]];if(o.blendShape)for(var l in a.morphTargetInfluences||(a.morphTargetInfluences={}),o.blendShape)a.morphTargetInfluences[l]||(a.morphTargetInfluences[l]={times:[],arr:[],class:v.ThreeObject.NumberKeyframeTrack}),a.morphTargetInfluences[l].arr.push(o.blendShape[l]/100),a.morphTargetInfluences[l].times.push(Number.parseFloat(n[i]));o.m_LocalPosition&&(a.position||(a.position={times:[],arr:[],class:v.ThreeObject.VectorKeyframeTrack}),a.position.arr.push(o.m_LocalPosition.x,o.m_LocalPosition.y,o.m_LocalPosition.z),a.position.times.push(Number.parseFloat(n[i]))),o.m_LocalRotation&&(a.quaternion||(a.quaternion={times:[],arr:[],class:v.ThreeObject.QuaternionKeyframeTrack}),a.quaternion.arr.push(o.m_LocalRotation.x,o.m_LocalRotation.y,o.m_LocalRotation.z,o.m_LocalRotation.w),a.quaternion.times.push(Number.parseFloat(n[i]))),o.m_LocalScale&&(a.scale||(a.scale={times:[],arr:[],class:v.ThreeObject.VectorKeyframeTrack}),a.scale.arr.push(o.m_LocalScale.x,o.m_LocalScale.y,o.m_LocalScale.z),a.scale.times.push(Number.parseFloat(n[i]))),s.push(Number.parseFloat(n[i]))}for(var c in a)if(a[c].class)a[c]=new a[c].class(e+"."+c,a[c].times,a[c].arr);else for(var u in a[c])a[c][u]&&(a[c]=new a[c][u].class(t+"."+c+"["+u+"]",a[c][u].times,a[c][u].arr));return{time:s[s.length-1],obj:a}}static generateTransformAnimationClip(e,t){for(var r=[],s=0;s<t.hierarchy.length;s++){var n=".objects["+a.getObjectIndex(e.objects,"name",t.hierarchy[s].name)+"]",i=t.hierarchy[s].name,o=this.parseClipData(n,i,t.hierarchy[s].keys);r=r.concat(Object.values(o.obj))}var l=new v.ThreeObject.AnimationClip(t.name,t.length,r);return l.id=t.id,l.mode=t.mode,l}static setAnimation(e,t){var r=new v.ThreeObject.AnimationMixer(e);if(t.clips&&t.clips.length>0){r.clips={};for(var a=0;a<t.clips.length;a++)t.clips[a]&&(r.clips[t.clips[a].name]=r.clipAction(t.clips[a],e),r.clips[t.clips[a].name].id=t.clips[a].id,r.clips[t.clips[a].name].name=t.clips[a].name,r.clips[t.clips[a].name].mode=this.loopMode(t.clips[a].mode),r.clips[t.clips[a].name].duration=t.clips[a].duration,r.clips[t.clips[a].name].setEffectiveWeight(1))}return r}static loopMode(e){return"Once"==e?v.ThreeObject.LoopOnce:"PingPong"==e?v.ThreeObject.LoopPingPong:v.ThreeObject.LoopRepeat}}class y{static get Material(){return n}static get Animations(){return d}static get SkinAnimations(){return b}static get Mesh(){return l}static get SkinnedMesh(){return o}static get Texture(){return c}static get Audio(){return g}static get Object(){return f}}class v{static setThreeJsObject(e){this._threeObject=e}static get ThreeObject(){return window.THREE?window.THREE:this._threeObject}static get object(){if("undefined"!=this.ThreeObject)return y;throw new Error("NO WEBGL LIBRARY INCLUDED!")}}class O{static loadImage(e,t,r,a,s){var n={data:null,loaded:!1,loadProgress:0,isFromByteArray:!self.Image};let i=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(n)if(e.indexOf("data:image/png;base64,")>-1)if(1==n.isFromByteArray){let t=self.atob(e.split(",")[1]),a=new Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let s=new Uint8Array(a);(i?self.createImageBitmap(new Blob([s],{type:"image/png"})):self.createImageBitmap(new Blob([s],{type:"image/png"}),{imageOrientation:"flipY"})).then((function(e){n.data=e,n.loaded=!0,r&&r()}))}else n.src=e,n.loadProgress=1,setTimeout(()=>{n.loaded=!0,r&&r()},0);else{var o=new XMLHttpRequest;o.onreadystatechange=()=>{if(4==o.readyState&&200==o.status)if(n.loadProgress=1,1==n.isFromByteArray){(i?self.createImageBitmap(new Blob([o.response],{type:"image/png"})):self.createImageBitmap(new Blob([o.response],{type:"image/png"}),{imageOrientation:"flipY"})).then((function(e){n.data=e,n.loaded=!0,r&&r()}))}else{n.data=new Image;var e=new Blob([o.response]);n.data.src=self.URL.createObjectURL(e),setTimeout(()=>{n.loaded=!0,r&&r()},0)}},o.onprogress=function(e){e.lengthComputable&&(n.loadProgress=e.loaded/e.total,a&&a(n.loadProgress))},o.onerror=s,o.open("GET",t+e,!0),o.responseType="arraybuffer",o.send()}return n}static loadImages(e,t,r,a,s){var n=[];if(e.length>0)for(var i=0;i<e.length;i++)for(var o=0;o<e[i].textureData.length;o++){var l=this.loadImage(e[i].textureData[o],t,r,a,s);l&&(e[i].textureData[o]=l,n.push(l))}else setTimeout(()=>{r&&r()},0);return n}static loadTexture(e){if(e&&e.textureData&&e.textureData.length>0){var t;switch(e.textureData.length){case 1:t=v.object.Texture.generateTexture(e);break;case 6:t=v.object.Texture.generateCubeTexture(e)}return t}}static loadTextures(e){for(var t=[],r=0;r<e.length;r++){var a=this.loadTexture(e[r]);a&&t.push(a)}return t}}class M{static loadAudio(e,t,r,a,s){var n={id:e.id,name:e.name,dataBuffer:null,loaded:!1,loadProgress:0,isFromByteArray:!0};if(n){var i=new XMLHttpRequest;i.onreadystatechange=()=>{if(4==i.readyState&&200==i.status){var e=new(self.AudioContext||self.webkitAudioContext);n.loadProgress=1,e.decodeAudioData(i.response,(function(e){n.dataBuffer=e,n.loaded=!0,r&&r()}),(function(e){console.error("Couldn't decode audio!")}))}},i.onprogress=function(e){e.lengthComputable&&a&&a(n.loadProgress)},i.onerror=s,i.open("GET",t+e.data,!0),i.responseType="arraybuffer",i.send()}return n}static loadAudios(e,t,r,a,s){var n=[];if(e.length>0)for(var i=0;i<e.length;i++){var o=this.loadAudio(e[i],t,r,a,s);n.push(o)}else setTimeout(()=>{r&&r()},0);return n}}var S={Type:0,Transform:1,Children:2,Position:3,Rotation:4,Scale:5,Id:6,Name:7,Tag:8,Materials:9,MeshID:10,AnimationID:11,LightData:12,CameraData:13,Collider:14,ParentBoneId:15,ScriptProperties:16,Sound:17,Flags:18,CombineMeshes:19,Reference:20};class j{static get enumDictionary(){let e={};return e[S.Type]="type",e[S.Transform]="transform",e[S.Children]="children",e[S.Position]="position",e[S.Rotation]="rotation",e[S.Scale]="scale",e[S.Id]="id",e[S.Name]="name",e[S.Tag]="tag",e[S.Materials]="materials",e[S.MeshID]="meshID",e[S.AnimationID]="animationID",e[S.LightData]="lightData",e[S.CameraData]="cameraData",e[S.Collider]="collider",e[S.ParentBoneId]="parentBoneId",e[S.ScriptProperties]="scriptProperties",e[S.Sound]="sound",e[S.Flags]="flags",e[S.CombineMeshes]="combineMeshes",e[S.Reference]="reference",e}static HierarchyEnumsToHumanReadable(e,t){if(e){t=t||this.enumDictionary;for(let r in e)if(t[r]){let a=e[r];delete e[r],e[t[r]]=a}if(this.HierarchyEnumsToHumanReadable(e[t[S.Transform]],t),this.HierarchyEnumsToHumanReadable(e[t[S.Flags]],t),e[t[S.Children]])for(let r=0;r<e[t[S.Children]].length;r++)this.HierarchyEnumsToHumanReadable(e[t[S.Children]][r],t)}}}class x{static isLoadComplete(e,t){var r=!0;if(e.generatedAssets.images)for(var a=0;a<e.generatedAssets.images.length;a++)e.generatedAssets.images[a]&&1!=e.generatedAssets.images[a].loaded&&(r=!1);if(e.generatedAssets.sounds)for(a=0;a<e.generatedAssets.sounds.length;a++)e.generatedAssets.sounds[a].loaded||(r=!1);1==r&&t()}static updateProgress(e,t){var r=0,a=0,s=0,n=0,i=0;if(e.generatedAssets.sounds){for(var o=0;o<e.generatedAssets.sounds.length;o++){r+=(l=e.generatedAssets.sounds[o].loadProgress)||0}r/=n=e.generatedAssets.sounds.length}if(e.generatedAssets.images){for(o=0;o<e.generatedAssets.images.length;o++){var l=0;e.generatedAssets.images[o]&&(l=e.generatedAssets.images[o].loadProgress),a+=l||0}a/=i=e.generatedAssets.images.length}s=(a+r)/2,n>0&&(s=r),i>0&&(s=a),i>0&&n>0&&(s=(a+r)/2),t&&t(s)}static preload(e,t,r,a,s){if(e){var n=!1,i=!1;if(e.generatedAssets=e.generatedAssets?e.generatedAssets:{},e.assets&&e.assets.textures&&e.assets.textures.length>0&&(n=!0,e.generatedAssets.images=O.loadImages(e.assets.textures,t,()=>{this.updateProgress(e,a),this.isLoadComplete(e,r)},()=>{this.updateProgress(e,a)},s)),e.assets&&e.assets.sounds&&e.assets.sounds.length>0){(self.AudioContext||self.webkitAudioContext)&&(i=!0,e.generatedAssets.sounds=M.loadAudios(e.assets.sounds,t,()=>{this.updateProgress(e,a),this.isLoadComplete(e,r)},()=>{this.updateProgress(e,a)},s))}0==n&&0==i&&r()}}static setAssets(e){j.HierarchyEnumsToHumanReadable(e.objects),e.assets&&e.assets.textures&&e.assets.textures.length>0&&(e.generatedAssets.textures=O.loadTextures(e.assets.textures)),e.assets&&e.assets.bones&&e.assets.bones.length,e.assets&&e.assets.materials&&e.assets.materials.length>0&&(e.generatedAssets.materials=v.object.Material.generateMaterials(e.assets.materials,e)),e.assets&&e.assets.meshes&&e.assets.meshes.length>0&&(e.generatedAssets.geometries=v.object.Mesh.parseGeometries(e.assets.meshes,e)),e.assets&&e.assets.animations&&e.assets.animations.length,e.objects&&v.object.Object.applyFlagsToObjects(e.objects,e)}static preloadData(e,t,r,a,s,n){n=0!=n||n,e&&this.preload(e,t,()=>{this.setAssets(e),e.createObject=function(e,t){},e.dispose=function(){},r&&setTimeout(()=>{var t={};t.data=e,n&&(t.object=v.object.Object.generateObject(e),t.object.clips&&t.object.clips.length>0&&(t.data.generatedAssets.animations=t.object.clips)),r(t)},1e3)},a,s)}}class P{static updateProgress(e,t,r){r&&(e.assetsProgress=r),e.totalProgress=e.dataProgress/2+e.assetsProgress/2,t&&t(e)}static onProgress(e,t,r){t.lengthComputable?(e.dataProgress=t.loaded/t.total,this.updateProgress(e,r)):(e.dataProgress=t.loaded/3145728,e.dataProgress=e.dataProgress>1?1:e.dataProgress,this.updateProgress(e,r))}static loadFromString(e,t,r,a,s,n){return x.preloadData(JSON.parse(e),t,r,a,s,n)}static load(e,t,r,a,s,n){n=n||5,e="/"==e[0]?e=e.substring(1,e.length):"."==e[0]?e.substring(2,e.length):e;var i="";if(e.split("/").length>0){var o=e.split("/");o.splice(o.length-1,1),i=(i=o.join("/")).length>0?i+"/":i}var l={totalProgress:0,assetsProgress:0,dataProgress:0},c=new XMLHttpRequest;c.onload=e=>{4==c.readyState&&200==c.status?this.loadFromString(c.responseText,i,t,e=>{this.updateProgress(l,r,e)},a,s):a&&a(c.status)},c.onprogress=e=>{this.onProgress(l,e,r)},c.open("GET",e,!0),c.send(null)}}r.d(t,"setThreejsObject",(function(){return C})),r.d(t,"load",(function(){return A})),r.d(t,"loadAsync",(function(){return T})),r.d(t,"loadFromString",(function(){return I})),r.d(t,"loadTexture",(function(){return D})),r.d(t,"generateObject",(function(){return w})),r.d(t,"getHierarchyObjectByPath",(function(){return z})),r.d(t,"getGeometryByPath",(function(){return _})),r.d(t,"combineObjects",(function(){return L})),r.d(t,"combineObjectsAsOne",(function(){return B})),r.d(t,"LoziUtils",(function(){return a}));const T=async(e,t,r,a)=>await new Promise(s=>{P.load(e,e=>{s(e)},t,r,a)}),A=(e,t,r,a,s)=>{P.load(e,t,r,a,s)},I=(e,t,r,a,s,n)=>{P.loadFromString(e,t,r,a,s,n)},D=(e,t,r,a)=>{let s=O.loadImage(e,"",()=>{let r=O.loadTexture({name:e,textureData:[s]});t&&t(r)},r,a)},w=(e,t)=>v.object.Object.generateObject(e,t),z=(e,t)=>v.object.Object.getHierarchyObjectByPath(e,t),_=(e,t)=>{let r=v.object.Object.getHierarchyObjectByPath(e.objects,t);if(r){if(r.meshID)for(let t=0;t<e.generatedAssets.geometries.length;t++)if(e.generatedAssets.geometries[t].meshID==r.meshID)return e.generatedAssets.geometries[t];return null}},C=e=>{v.setThreeJsObject(e)},L=(e,t,r)=>v.object.Object.combineGeometries(e,t,r),B=(e,t)=>v.object.Object.combineObjectsAsOne(e,t)}]);